<?php include 'common/header.php';?>
<?php include 'common/sidebar.php';?>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="<?php echo base_url() ?>assets/plugins/ckeditor/ckeditor/ckeditor.js"></script>
<div class="d-flex flex-column flex-column-fluid container-fluid">
	<!--begin::Toolbar-->
	<div class="toolbar mb-5 mb-lg-7" id="kt_toolbar">

		<!--begin::Actions-->
		<div class="d-flex align-items-center py-2 py-md-1">
			<!--begin::Wrapper-->
			<div class="me-3">

				<!--end::Menu-->
			</div>
			<!--end::Wrapper-->
			<!--begin::Button-->

			<!--end::Button-->
		</div>
		<!--end::Actions-->
	</div>
	<!--end::Toolbar-->
	<!--begin::Post-->
	<div class="content flex-column-fluid" id="kt_content">
		<!--begin::Card-->


		<div class="card p-2">
			<!--begin::Input group-->
			<div class="row">
				<div class="col-md-12 ">
					<div class="card mb-2 mb-xl-5">
						<!--begin::Form-->
						<form class="form" action="#" data-kt-redirect="#">
							<!--begin::Modal header-->
							<div class="p-4">
								<!--begin::Modal title-->
								<h2 class="fw-bold" id="quote_heading"></h2>
								<!--end::Modal title-->

							</div>
							<!--end::Modal header-->
							<!--begin::Modal body-->
							<div class="modal-body px-lg-10">
								<!--begin::Scroll-->
								<div class="scroll-y me-n7 pe-7" id="kt_modal_add_customer_scroll" data-kt-scroll="true"
									data-kt-scroll-activate="{default: false, lg: true}"
									data-kt-scroll-max-height="auto"
									data-kt-scroll-dependencies="#kt_modal_add_customer_header"
									data-kt-scroll-wrappers="#kt_modal_add_customer_scroll"
									data-kt-scroll-offset="300px">
									<input type="hidden" id="template_id">
									<div class="row g-9 mb-2">
										<div class="col-md-12 fv-row">
											<label class="required fs-6 fw-semibold mb-2">Order Type</label>
											<select name="qordtype" id="qordtype" aria-label="Select a Order Type"
												onchange="gettemplategenerated()" data-control="select2"
												data-placeholder="Select a Order Type..."
												class="form-select form-select-solid form-select-lg fw-semibold">


											</select>
										</div>
										<div class="col-md-12 fv-row">
											<label class="required fs-6 fw-semibold mb-2">Terms & Conditions</label>
											<textarea type="text" class="form-control form-control-solid"
												placeholder="Terms & Conditions" name="description" id="description"
												value=""></textarea>

										</div>

									</div>



								</div>
							</div>
							<div class="card-footer d-flex justify-content-end py-6 px-9">
								<!--begin::Button-->
								<button type="button" onclick="getclear()" class="btn btn-light me-3"
									data-bs-dismiss="modal">Clear</button>
								<!--end::Button-->
								<!--begin::Button-->
								<button type="button" onclick="getinsert()" class="btn btn-primary">
									<span class="indicator-label">Submit</span>

								</button>
								<!--end::Button-->
							</div>
						</form>
						<!--end::Form-->
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<div class="card p-2" style="    background-color: transparent ! important;">
				</div>
			</div>
		</div>
		<div class="card p-2" id="dwn">
			<!--begin::Input group-->
			<div class="row">
				<div class="col-md-12 ">


					<!--begin::Card header-->
					<div class="p-4">


					</div>
					<!--end::Card header-->
					<!--begin::Card body-->
					<div class="card-body pt-0">
						<!--begin::Table-->
						<div class="table-responsive">

							<div class="mb-2">
								<!-- <button class="btn btn-outline-primary btn-sm mb-1 mb-xl-0" id="download-csv">Download CSV</button> -->
								<!-- <button class="btn btn-outline-primary btn-sm mb-1 mb-xl-0" id="download-json">Download JSON</button> -->
								<button class="btn btn-light-primary btn btn-outline-primary btn-sm mb-1 mb-xl-0"
									id="download-xlsx">Download XLSX</button>
								<button class="btn btn-light-primary btn btn-outline-primary btn-sm mb-1 mb-xl-0"
									id="download-pdf">Download PDF</button>
								<!-- <button class="btn btn-outline-primary btn-sm mb-1 mb-xl-0" id="download-html">Download HTML</button> -->


							</div>
							<div id="datatable-3"></div>
							<table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_table_users">
								<!--begin::Table head-->
								<thead>
									<!--begin::Table row-->
									<tr class="text-start text-muted fw-bold fs-7 text-uppercase gs-0">

										<th class="min-w-10px">Sl No</th>
										<th class="min-w-125px">Order Type</th>
									
										<th class="text-end min-w-100px">Actions</th>
									</tr>
									<!--end::Table row-->
								</thead>

								<tbody class="text-gray-600 fw-semibold">
									<?php foreach ($templates as $template): ?>
									<tr>
										<td>
											<?php echo $template['slno']; ?>
										</td>
										<td>
											<?php echo $template['otypename']; ?>
										</td>
									
										<td>
										   
											<a onclick='delete_templates(<?php echo $template[' otype_id']; ?>)' class="btn btn-sm btn-icon  btn me-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete">
														<!--begin::Svg Icon | path: icons/duotune/general/gen027.svg-->
														<span class="svg-icon svg-icon-2 m-0">
															<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
																<path d="M5 9C5 8.44772 5.44772 8 6 8H18C18.5523 8 19 8.44772 19 9V18C19 19.6569 17.6569 21 16 21H8C6.34315 21 5 19.6569 5 18V9Z" fill="currentColor" />
																<path opacity="0.5" d="M5 5C5 4.44772 5.44772 4 6 4H18C18.5523 4 19 4.44772 19 5V5C19 5.55228 18.5523 6 18 6H6C5.44772 6 5 5.55228 5 5V5Z" fill="currentColor" />
																<path opacity="0.5" d="M9 4C9 3.44772 9.44772 3 10 3H14C14.5523 3 15 3.44772 15 4V4H9V4Z" fill="currentColor" />
															</svg>
														</span>
														<!--end::Svg Icon-->
													</a>
											<!--<a -->
											<!--	title='Edit'><i class='fa fa-pencil' style='color:#009ef7'></i></a>-->
											&nbsp;
											<!--<a onclick='delete_templates(<?php echo $template[' otype_id']; ?>)'-->
											<!--	title='Delete'><i class='fa fa-trash' style='color:#009ef7'></i></a>-->
										</td>
									</tr>
									<?php endforeach; ?>
								</tbody>
								<!--end::Table body-->
							</table>
						</div>
						<!--end::Table-->
					</div>
					<!--end::Card body-->
				</div>

			</div>
		</div>
	</div>
	<?php include 'common/footer.php';?>
	<script type="text/javascript">
// 		$('#kt_table_users').DataTable();
		CKEDITOR.replace('description');

		function pageload() {
			$("#quote_heading").html("Add Templates");
			$("#template_id").val('');
			$("#qordtype").empty();
			CKEDITOR.instances.description.setData('');

			$.ajax({
				method: "post",
				url: '<?php echo base_url()?>Quotation/get_ordtype',
				data: {},
				beforeSend: function () {
					$("#qordtype").empty();
				},
				success: function (data) {
					var data = JSON.parse(data);
					// console.log(data);
					$("#qordtype").append('<option value="">Select</option>');
					for (var i = 0; i < data.length; i++) {
						$("#qordtype").append('<option value="' + data[i].otype_id + '">' + data[i].otypename + '</option>');
					}
				},
			});
			var rowMenu = [

			]
// 			$.ajax({
// 				url: "<?php echo base_url() ?>Quotation/get_templates",
// 				type: 'post',
// 				dataType: "json",
// 				data: {
// 				},
// 				success: function (data) {
// 					console.log(data);
// 					if (data != "") {
// 						$("#dwn").show();
// 						var table = new Tabulator("#datatable-3", {
// 							data: data,           //load row data from array
// 							layout: "fitColumns",      //fit columns to width of table
// 							responsiveLayout: "collapse",  //hide columns that dont fit on the table
// 							tooltips: true,            //show tool tips on cells
// 							addRowPos: "top",          //when adding a new row, add it to the top of the table
// 							history: false,             //allow undo and redo actions on the table
// 							pagination: "local",       //paginate the data
// 							paginationSize: 10,         //allow 7 rows per page of data
// 							resizableColumns: false,
// 							rowContextMenu: rowMenu,      //allow column order to be changed
// 							resizableRows: false,       //allow row order to be changed
// 							initialSort: [             //set the initial sort order of the data
// 								{ column: "name", dir: "asc" },
// 							],
// 							columns: [                 //define the table columns
// 								{ title: "SL NO", field: "slno", editor: false, width: "10%" },
// 								{ title: "Order Type", field: "otypename", width: "69%", editor: false, headerFilter: "input" },
// 								{ title: "Action", field: "link", tooltip: "Action", width: "20%", editor: false, formatter: "html", print: false, download: false },
// 							],
// 						});
// 						document.getElementById("download-xlsx").addEventListener("click", function () {
// 							table.download("xlsx", "People Pass Type list.xlsx", { sheetName: "My Data" });
// 						});
// 						document.getElementById("download-pdf").addEventListener("click", function () {
// 							table.download("pdf", "People Pass Type list.pdf", {
// 								orientation: "portrait", //set page orientation to portrait
// 								title: "People Pass Type List", //add title to report
// 							});
// 						});
// 					}
// 					else {
// 						$("#dwn").hide();
// 					}
// 				}
// 			});

		}
		
		function getinsert() {
			var qordtype = $('#qordtype').val();
			var template_id = $("#template_id").val();
			var description = CKEDITOR.instances.description.getData();
			if (qordtype != "" && description != "") {
				if (template_id == "") {
					$.ajax({
						method: "post",
						url: '<?php echo base_url()?>Quotation/insert_templates',
						data: { qordtype: qordtype, description: description },
						beforeSend: function () {
						},
						success: function (d) {
							console.log(d);
							if (d == 1) {
								$("#qordtype").empty();
								CKEDITOR.instances.description.setData('');
								pageload();
							}
							else if (d == 0) {
								alert('order type already added');
							}
							else {
								alert('insertion failed');
							}
						},
					});
				}
				else {
					$.ajax({
						method: "post",
						url: '<?php echo base_url()?>Quotation/update_templates',
						data: { qordtype: qordtype, description: description, template_id: template_id },
						beforeSend: function () {
						},
						success: function (d) {
							$("#template_id").val('');
							$("#qordtype").empty();
							CKEDITOR.instances.description.setData('');
							pageload();
						},
					});
				}

			}
			else {
				alert("Order type and description required");
			}
		}

		//pageload();

		function editmodel(id) {
			$.ajax({
				method: "post",
				url: '<?php echo base_url() ?>Quotation/get_templates_byid',
				dataType: "json",
				data: { template_id: id },
				beforeSend: function () {
				},
				success: function (data) {
					console.log(data);
					$("#template_id").val(data.template_id);
					$("#qordtype").html(data.ordtype_data);
					CKEDITOR.instances.description.setData(data.description);
				},
			});

		}
		function getclear() {
			if (confirm("Do you Sure You want to Clear all Data?")) {
				pageload();
			}
		}
		function delete_templates(id) {
			if (confirm("Do you Sure You want to Delete this templates?")) {
				$.ajax({
					method: "post",
					url: '<?php echo base_url() ?>Quotation/delete_templates',
					data: { template_id: id },
					beforeSend: function () {
					},
					success: function (data) {
						if (data == "1")
							pageload();
						else {
							alert(" Can't delete ");
						}
					},
				});
			}
		}
		function gettemplategenerated() {
			var qordtype = $('#qordtype').val();
			$.ajax({
				method: "post",
				url: '<?php echo base_url()?>Quotation/get_description',
				data: { qordtype: qordtype },
				beforeSend: function () {
					CKEDITOR.instances.description.setData('');
				},
				success: function (data) {

					if (data.length > 0) {
						//    alert('hi');
						var data = JSON.parse(data);
						CKEDITOR.instances.description.setData(data);
					}
				},
			});
		}
	</script>
	<!--end::Post-->